<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="lib/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
      <link rel="stylesheet" type="text/css" href="css/css.css">
    <script type="text/javascript" src="js/persona.js"></script>
  </head>
  <body>

<div class="container">
    <div class="row">
      <div class="col-sm-6">
        <h2>Lista Contatti</h2>
        <button onclick="aggiungiContatto();" class="btn btn-default">Aggiungi Contatto</button>
        <table class="table">

          <thead>
            <tr>            
              <th>Cognome</th>
              <th>Nome</th>
              <th>Telefono</th>
              <th>Modifica</th>
              <th>Cancella</th>
            </tr>
          </thead>

          <tbody id="tb_contatti">
          </tbody>

          <tfoot>
          </tfoot>

        </table>
        </div>

        <div id="mod" class="col-sm-6">
          <div>
          <h2>Scheda Modifica</h2>

          <table id="schedaContatto" class="table">
            <tr><td></td><td><input id="dettaglio_id" type="hidden" /></td></tr>
            <tr><td>Nome</td><td><input id="dettaglio_nome" type="text"></td></tr>
            <tr><td>Cognome</td><td><input id="dettaglio_cognome" type="text"></td></tr>
            <tr><td>Telefono</td><td><input id="dettaglio_telefono" type="text"></td></tr>
            <tr><td></td><td><button onClick="salvaContatto();" class="btn btn-default">Salva Contatto</button></td></tr>
          </table>

          </div>
      </div>
    </div>
  </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
         
    <!-- <script type="js/template.js"></script> -->
    <script type="text/javascript">

    function vediDettaglio(id)
    {
      for(i=0;i<persone.length;i++)
      {
        if(persone[i].id==id)
        {
          document.getElementById("dettaglio_id").value=persone[i].id;
          document.getElementById("dettaglio_nome").value=persone[i].nome;
          document.getElementById("dettaglio_cognome").value=persone[i].cognome;
          document.getElementById("dettaglio_telefono").value=persone[i].telefono;

        }
      }
      document.getElementById("mod").style.visibility="visible";
    }
    
    function salvaContatto()
    {
      var id=document.getElementById("dettaglio_id").value;
      var nome=document.getElementById("dettaglio_nome").value;
      var cognome=document.getElementById("dettaglio_cognome").value;
      var telefono=document.getElementById("dettaglio_telefono").value;
      //nuovo contatto
      // console.log(id);
      if(id==0)
      {
        var persona = {};
        persona.id=calcolaMaxId();
        persona.nome=nome;
        persona.cognome=cognome;
        persona.telefono=telefono;

        persone.push(persona);//aggiunge in coda 
        caricaContatti();
      }//modifica contatto esistente
      else
      {
        for(i=0;i<persone.length;i++)
        {
          if(persone[i].id==id)
          {
            persone[i].nome=nome;
            persone[i].cognome=cognome;
            persone[i].telefono=telefono;
          }
        }
        caricaContatti();
      }
      // caricaContatti();
    }

    function caricaContatti()
    {
      document.getElementById("tb_contatti").innerHTML="";
      for(i=0;i<persone.length;i++)
      {
        var obj=persone[i];
        var tr=document.createElement("tr");

        var td1=document.createElement("td");
        var td2=document.createElement("td");
        var td3=document.createElement("td");
        var td4=document.createElement("td");
        var td5=document.createElement("td");

        td1.innerHTML=obj.cognome;
        td2.innerHTML=obj.nome;
        td3.innerHTML=obj.telefono;
        td4.innerHTML="<a title='Modifica "+obj.nome+" "+obj.cognome+"' href='javascript:;' onclick='vediDettaglio("+obj.id+")' >modifica</a>";
        // td5.innerHTML="<a href='javascript:;' onclick='cancellaContatto("+obj.id+");' title='Cancella "+obj.nome+" "+obj.cognome+"''>Cancella</a>";
        td5.innerHTML="<a href='javascript:;' onclick='cancellaContatto("+obj.id+");' title='Cancella "+obj.nome+" "+obj.cognome+"'>"+
        "<i class='glyphicon glyphicon-trash'"+"</a>";
        tr.appendChild(td1);
        tr.appendChild(td2);
        tr.appendChild(td3);
        tr.appendChild(td4);
        tr.appendChild(td5);

        document.getElementById("tb_contatti").appendChild(tr);
      }
      // console.log(persone)
    }

    function aggiungiContatto()
    {
      document.getElementById("dettaglio_id").value=0;
      document.getElementById("dettaglio_nome").value="";
      document.getElementById("dettaglio_cognome").value="";
      document.getElementById("dettaglio_telefono").value="";
      document.getElementById("schedaContatto").style.visibility="visible";

    }

    function calcolaMaxId()
    {
      var id =0;
      for(i=0;i<persone.length;i++)
      {
        if(persone[i].id>id)
        {
          id=persone[i].id;
        }
      }
      id++;
      return id;
    }

    function cancellaContatto(id)
    {
      if(confirm("Sicuro?"))
      {
        // array.splice(index, 1);
        for(i=0;i<persone.length;i++)
        {
          if(persone[i].id==id)
          {
            persone.splice(i,1); //cancella un elemento dall'array partendo da un indice per il valore passato come secondo parametro
          }
        }
        caricaContatti();
      }
    }

    caricaContatti();

    </script>
  </body>
</html>